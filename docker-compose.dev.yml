# docker-compose.dev.yml
version: '3.8'

services:
  words-db:
    image: postgres:16
    container_name: words-db-dev
    restart: unless-stopped
    environment:
      POSTGRES_DB: words_db
      POSTGRES_USER: crossword
      POSTGRES_PASSWORD: devpass123
    ports:
      - "5433:5432"
    volumes:
      - words_db_dev_data:/var/lib/postgresql/data
    networks:
      - crossword-net

  crosswords-db:
    image: postgres:16
    container_name: crosswords-db-dev
    restart: unless-stopped
    environment:
      POSTGRES_DB: crosswords_db
      POSTGRES_USER: crossword
      POSTGRES_PASSWORD: devpass123
    ports:
      - "5434:5432"
    volumes:
      - crosswords_db_dev_data:/var/lib/postgresql/data
    networks:
      - crossword-net

  rabbitmq:
    image: rabbitmq:3.13-management
    container_name: rabbitmq-dev
    restart: unless-stopped
    ports:
      - "5672:5672"
      - "15672:15672"
    environment:
      RABBITMQ_DEFAULT_USER: crossword
      RABBITMQ_DEFAULT_PASS: devpass123
    networks:
      - crossword-net

  # --- НОВЫЙ СЕРВИС: words-service ---
  words-service:
    build:
      context: ./apps/words
      dockerfile: Dockerfile.dev
    container_name: words-service-dev
    depends_on:
      - words-db
    environment:
      - NODE_ENV=development
      - DB_HOST=words-db
      - DB_PORT=5432
      - DB_NAME=words_db
      - DB_USERNAME=crossword
      - DB_PASSWORD=devpass123
    ports:
      - "3003:3000"  # например
    volumes:
      - ./apps/words:/app
      - /app/node_modules
    networks:
      - crossword-net

  storage-service:
    build:
      context: ./apps/storage
      dockerfile: Dockerfile.dev
    container_name: storage-service-dev
    depends_on:
      - crosswords-db
      - rabbitmq
    environment:
      - NODE_ENV=development
      - DB_HOST=crosswords-db
      - DB_PORT=5432
      - DB_NAME=crosswords_db
      - DB_USERNAME=crossword
      - DB_PASSWORD=devpass123
      - RABBITMQ_URI=amqp://crossword:devpass123@rabbitmq:5672
    ports:
      - "3001:3000"
    volumes:
      - ./apps/storage:/app
      - /app/node_modules
    networks:
      - crossword-net

  generator-service:
    build:
      context: ./apps/generator
      dockerfile: Dockerfile.dev
    container_name: generator-service-dev
    depends_on:
      - words-db
      - rabbitmq
    environment:
      - NODE_ENV=development
      - DB_HOST=words-db
      - DB_PORT=5432
      - DB_NAME=words_db
      - DB_USERNAME=crossword
      - DB_PASSWORD=devpass123
      - RABBITMQ_URI=amqp://crossword:devpass123@rabbitmq:5672
    ports:
      - "3002:3000"
    volumes:
      - ./apps/generator:/app
      - /app/node_modules
    networks:
      - crossword-net

volumes:
  words_db_dev_data:
  crosswords_db_dev_data:

networks:
  crossword-net:
    driver: bridge